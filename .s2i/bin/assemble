#!/bin/bash

set -eo pipefail

echo "---> Install the additional features"
if [ ! -z "$FEATURES" ]
  then
    installUtility install --acceptlicense $FEATURES
fi

echo "--> Copy in the jvm options"

if [ -f /tmp/src/jvm.options ]
  then
    cp /tmp/src/jvm.options /config/jvm/options
    chown websphere.websphere /config/jvm/options
fi

echo "---> Copying EAR files"

if [ -d /tmp/src/dropins ]
  then
    cp /tmp/src/dropins/*.ear /config/dropins
    cp /tmp/src/dropins/*.war /config/dropins
fi

echo "---> Copy the server.xml"

cp /tmp/src/server.xml /config

echo "---> Fix permissions on liberty directories"

chmod -Rf g+w /config /opt/ibm/wlp /logs
#chmod -Rf g+w /opt/app-root/htdocs || true
